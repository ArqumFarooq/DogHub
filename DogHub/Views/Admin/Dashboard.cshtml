@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using DogHub.BL
@using DogHub.Models
@{
    DogHubEntities de = new DogHubEntities();

    var identity = (System.Security.Claims.ClaimsPrincipal)System.Threading.Thread.CurrentPrincipal;
    var id = identity.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Sid).Select(c => c.Value).SingleOrDefault();

    User loggedinUser = new UserBL().GetUserById(Convert.ToInt32(id), de);
}

@if (loggedinUser.IsAdmin == true)
{
    ViewBag.Title = "Admin Dashboard";
<div class="container mt-5">
    <h2 class="text-center mb-4">Welcome Admin</h2>

    <div class="row text-white">
        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#1bafd0; border-radius: 15px;">
                <h5 class="text-center">Total Users</h5>
                <h2 class="text-center">@ViewBag.UserCount</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#3be8b0; border-radius: 15px;">
                <h5 class="text-center">Total Audit Logs</h5>
                <h2 class="text-center">@ViewBag.AuditLogCount</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#fd636b; border-radius: 15px;">
                <h5 class="text-center">Your Audit Actions</h5>
                <h2 class="text-center">@(@ViewBag.AuditLogCountByUser ?? 0)</h2>
            </div>
        </div>
    </div>
    <br>
    <br>
    <div class="row text-white">
        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#e83b6e; border-radius: 15px;">
                <h5 class="text-center">Total Dog Breeds</h5>
                <h2 class="text-center">@ViewBag.DogBreedCount</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#3b8de8; border-radius: 15px;">
                <h5 class="text-center">Total Sub-Breeds</h5>
                <h2 class="text-center">@ViewBag.SubBreedCount</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="p-4 mb-4" style="background-color:#ff9a59; border-radius: 15px;">
                <h5 class="text-center">Your Contributions</h5>
                <h2 class="text-center">@(@ViewBag.DogBreedCountByUser ?? 0)</h2>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-md-6">
            <canvas id="BreedChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="auditChart"></canvas>
        </div>
    </div>
</div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    const userCount = @ViewBag.UserCount ?? 0;
    const breedCount = @ViewBag.DogBreedCount ?? 0;
    const subBreedCount = @ViewBag.SubBreedCount ?? 0;
    const auditTotal = @ViewBag.AuditLogCount ?? 0;
    const auditUser = @ViewBag.AuditLogCountByUser ?? 0;

    // Bar Chart: Users vs Dog Breeds
    new Chart(document.getElementById('BreedChart'), {
        type: 'bar',
        data: {
            labels: ['Dog Breeds', 'Sub Breeds'],
            datasets: [{
                label: 'System Data',
                data: [breedCount, subBreedCount],
                backgroundColor: ['#e83b6e', '#3b8de8']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Total  Dog Breeds vs. Sub Breeds'
                },
                legend: {
                    display: false
                }
            }
        }
    });

    // Doughnut Chart: Audit Contributions
    new Chart(document.getElementById('auditChart'), {
        type: 'doughnut',
        data: {
            labels: ['Your Actions', 'Other Logs'],
            datasets: [{
                data: [auditUser, auditTotal - auditUser],
                backgroundColor: ['#fd636b', '#FFB900']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Your Audit Actions vs. All Logs'
                }
            }
        }
    });
    </script>

    <style>
        canvas {
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
}
@if (loggedinUser.IsAdmin == false)
{
    ViewBag.Title = "User Dashboard";
    <div class="container mt-5">
        <h2 class="text-center mb-4">Welcome, @User.Identity.Name!</h2>

        <div class="row text-white">
            <div class="col-md-4">
                <div class="p-4 mb-4" style="background-color:#3be8b0; border-radius: 15px;">
                    <h5 class="text-center">Total Dog Breeds</h5>
                    <h2 class="text-center">@ViewBag.DogBreedCount</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-4 mb-4" style="background-color:#f4a261; border-radius: 15px;">
                    <h5 class="text-center">Total Sub-breeds</h5>
                    <h2 class="text-center">@ViewBag.SubBreedCount</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-4 mb-4" style="background-color:#4f81c7; border-radius: 15px;">
                    <h5 class="text-center">Your Contributions</h5>
                    <h2 class="text-center">@(@ViewBag.DogBreedCountByUser ?? 0)</h2>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-6">
                <canvas id="breedChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="contributionChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    const totalBreeds = @Html.Raw(ViewBag.DogBreedCount ?? 0);
    const dogContributions = @Html.Raw(ViewBag.DogBreedCountByUser ?? 0);
    const totalSubBreeds = @Html.Raw(ViewBag.SubBreedCount ?? 0);

    // Bar Chart
    new Chart(document.getElementById('breedChart'), {
        type: 'bar',
        data: {
            labels: ['Dog Breeds', 'Sub-breeds'],
            datasets: [{
                label: 'Breed Data',
                data: [totalBreeds, totalSubBreeds],
                backgroundColor: ['#3be8b0', '#f4a261']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Dog Breeds vs. Sub-breeds'
                },
                legend: {
                    display: false
                }
            }
        }
    });

    // Pie Chart
    new Chart(document.getElementById('contributionChart'), {
        type: 'doughnut',
        data: {
            labels: ['Your Contributions', 'Other Breeds'],
            datasets: [{
                data: [dogContributions, totalBreeds - dogContributions],
                backgroundColor: ['#4f81c7', '#ccc']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Your Share in Dog Breeds'
                }
            }
        }
    });
    </script>
    <style>
        canvas {
            background: #fff;
            min-height: 300px;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
}