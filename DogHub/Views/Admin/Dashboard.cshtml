@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using DogHub.BL
@using DogHub.Models
@{
    DogHubEntities de = new DogHubEntities();

    var identity = (System.Security.Claims.ClaimsPrincipal)System.Threading.Thread.CurrentPrincipal;
    var id = identity.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Sid).Select(c => c.Value).SingleOrDefault();

    User loggedinUser = new UserBL().GetUserById(Convert.ToInt32(id), de);
}

@if (loggedinUser.IsAdmin == true)
{
    ViewBag.Title = "Admin Dashboard";
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <div class="container mt-5">
        <br>

        @{
            var hour = DateTime.Now.Hour;
            string greeting;

            if (hour < 12)
            {
                greeting = "Good Morning";
            }
            else if (hour < 17)
            {
                greeting = "Good Afternoon";
            }
            else
            {
                greeting = "Good Evening";
            }
        }
        <h2 class="text-center mb-4">@greeting, Admin! 👋</h2>
        <br>

        <div class="row text-white">

            <!-- Total Users -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #1bafd0, #0d8aad); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-users fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Users</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.UserCount</h2>
                    <br>
                </div>
            </div>

            <!-- Total Audit Logs -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #3be8b0, #14c29c); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-clipboard-list fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Audit Logs</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.AuditLogCount</h2>
                    <br>
                </div>
            </div>

            <!-- User-Specific Audit Logs -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #fd636b, #d1444c); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-user-shield fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Your Audit Actions</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@(@ViewBag.AuditLogCountByUser ?? 0)</h2>
                    <br>
                </div>
            </div>

        </div>

        <br>
        <br>
        <div class="row text-white">

            <!-- Total Dog Breeds -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #e83b6e, #c32658); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-dog fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Dog Breeds</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.DogBreedCount</h2>
                    <br>
                </div>
            </div>

            <!-- Total Sub-Breeds -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #3b8de8, #1f6dd4); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-paw fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Sub-Breeds</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.SubBreedCount</h2>
                    <br>
                </div>
            </div>

            <!-- Your Contributions -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #ff9a59, #f36b1c); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-user-edit fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Your Contributions</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@(@ViewBag.DogBreedCountByUser ?? 0)</h2>
                    <br>
                </div>
            </div>

        </div>
        <br>
        <br>

        <div class="row mt-5">
            <div class="col-md-6">
                <canvas id="BreedChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="auditChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    const userCount = @ViewBag.UserCount ?? 0;
    const breedCount = @ViewBag.DogBreedCount ?? 0;
    const subBreedCount = @ViewBag.SubBreedCount ?? 0;
    const auditTotal = @ViewBag.AuditLogCount ?? 0;
    const auditUser = @ViewBag.AuditLogCountByUser ?? 0;

    // Bar Chart: Users vs Dog Breeds
    new Chart(document.getElementById('BreedChart'), {
        type: 'bar',
        data: {
            labels: ['Dog Breeds', 'Sub Breeds'],
            datasets: [{
                label: 'System Data',
                data: [breedCount, subBreedCount],
                backgroundColor: ['#e83b6e', '#3b8de8']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Total  Dog Breeds vs. Sub Breeds'
                },
                legend: {
                    display: false
                }
            }
        }
    });

    // Doughnut Chart: Audit Contributions
    new Chart(document.getElementById('auditChart'), {
        type: 'doughnut',
        data: {
            labels: ['Your Actions', 'Other Logs'],
            datasets: [{
                data: [auditUser, auditTotal - auditUser],
                backgroundColor: ['#fd636b', '#FFB900']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Your Audit Actions vs. All Logs'
                }
            }
        }
    });
    </script>

    <style>
        canvas {
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
}
@if (loggedinUser.IsAdmin == false)
{
    ViewBag.Title = "User Dashboard";
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <div class="container mt-5">
        <br>
        @{
            var hour = DateTime.Now.Hour;
            string greeting;

            if (hour < 12)
            {
                greeting = "Good Morning";
            }
            else if (hour < 17)
            {
                greeting = "Good Afternoon";
            }
            else
            {
                greeting = "Good Evening";
            }
        }
        <h2 class="text-center mb-4">@greeting, @User.Identity.Name! 👋</h2>
        <br>

        <div class="row text-white">

            <!-- Total Dog Breeds -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #e83b6e, #c32658); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-dog fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Dog Breeds</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.DogBreedCount</h2>
                    <br>
                </div>
            </div>

            <!-- Total Sub-Breeds -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #3b8de8, #1f6dd4); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-paw fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Total Sub-Breeds</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@ViewBag.SubBreedCount</h2>
                    <br>
                </div>
            </div>

            <!-- Your Contributions -->
            <div class="col-md-4">
                <div class="p-4 mb-4 shadow-lg" style="background: linear-gradient(135deg, #ff9a59, #f36b1c); border-radius: 20px;">
                    <div class="text-center mb-2">
                        <br>
                        <i class="fas fa-user-edit fa-2x mb-2 text-white"></i>
                        <br>
                        <h5 class="fw-bold">Your Contributions</h5>
                    </div>
                    <h2 class="text-center fw-bold display-4">@(@ViewBag.DogBreedCountByUser ?? 0)</h2>
                    <br>
                </div>
            </div>

        </div>
        <br>
        <br>

        <div class="row mt-5">
            <div class="col-md-6">
                <canvas id="breedChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="contributionChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    const totalBreeds = @Html.Raw(ViewBag.DogBreedCount ?? 0);
    const dogContributions = @Html.Raw(ViewBag.DogBreedCountByUser ?? 0);
    const totalSubBreeds = @Html.Raw(ViewBag.SubBreedCount ?? 0);

    // Bar Chart
    new Chart(document.getElementById('breedChart'), {
        type: 'bar',
        data: {
            labels: ['Dog Breeds', 'Sub-breeds'],
            datasets: [{
                label: 'Breed Data',
                data: [totalBreeds, totalSubBreeds],
                backgroundColor: ['#3be8b0', '#f4a261']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Dog Breeds vs. Sub-breeds'
                },
                legend: {
                    display: false
                }
            }
        }
    });

    // Pie Chart
    new Chart(document.getElementById('contributionChart'), {
        type: 'doughnut',
        data: {
            labels: ['Your Contributions', 'Other Breeds'],
            datasets: [{
                data: [dogContributions, totalBreeds - dogContributions],
                backgroundColor: ['#4f81c7', '#ccc']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Your Share in Dog Breeds'
                }
            }
        }
    });
    </script>
    <style>
        canvas {
            background: #fff;
            min-height: 300px;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
}